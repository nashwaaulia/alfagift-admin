<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Manajemen Voucher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        .admin-panel {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .admin-actions {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }
        
        .voucher-card {
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            overflow: hidden;
            border: 1px solid #dee2e6;
        }
        
        .voucher-header {
            background-color: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .voucher-body {
            padding: 15px;
        }
        
        .voucher-footer {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .voucher-section {
            margin-bottom: 25px;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none;
            z-index: 1000;
        }
        
        .modal-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 500px;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1001;
            display: none;
        }
        
        .success-modal, .error-modal {
            text-align: center;
        }
        
        .success-icon, .error-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .success-icon {
            color: #28a745;
        }
        
        .error-icon {
            color: #dc3545;
        }
        
        .btn-custom {
            width: 100%;
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            border: none;
            font-weight: bold;
        }
        
        .btn-save {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
        
        .btn-redeem {
            background-color: #007bff;
            color: white;
        }
        
        .btn-back {
            background-color: #007bff;
            color: white;
        }
        
        .form-check-input:checked {
            background-color: #007bff;
            border-color: #007bff;
        }
        
        .section-title {
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .show-all-link {
            color: #6c757d;
            text-decoration: none;
            font-size: 0.9rem;
        }
        
        .voucher-input {
            margin-top: 10px;
        }
        
        .voucher-item {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
            overflow: hidden;
            background-color: #e7f1ff; /* Warna biru muda untuk semua voucher */
        }
        
        .voucher-item-header {
            background-color: #cfe2ff; /* Warna biru lebih tua untuk header */
            padding: 12px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .voucher-item-title {
            font-weight: bold;
            font-size: 0.95rem;
        }
        
        .voucher-item-discount {
            color: #dc3545;
            font-weight: bold;
        }
        
        .voucher-item-body {
            padding: 15px;
            display: flex;
            align-items: center;
        }
        
        .voucher-item-icon {
            font-size: 24px;
            color: #007bff;
            margin-right: 15px;
        }
        
        .voucher-item-details {
            flex: 1;
        }
        
        .voucher-item-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .voucher-item-desc {
            color: #495057;
            font-size: 0.85rem;
            margin-bottom: 0;
        }
        
        .voucher-item-expiry {
            color: #dc3545;
            font-size: 0.8rem;
            margin-top: 5px;
        }
        
        .voucher-item-footer {
            padding: 10px 15px;
            background-color: #cfe2ff; /* Warna biru lebih tua untuk footer */
            border-top: 1px dashed #dee2e6;
            font-size: 0.8rem;
            color: #495057;
        }
        
        .voucher-actions {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .btn-sm {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .form-control {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 4px;
        }
        
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .voucher-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-expired {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
</head>

<body>

    <div class="container-fluid p-0 d-flex flex-column min-vh-100">

        <!-- Header (tidak diubah) -->
        <div class="bg-primary text-white p-3 d-flex align-items-center">
            <a href="dashboardkatalog.html" class="text-white me-3">
                <i class="bi bi-arrow-left fs-4"></i>
            </a>
            <h5 class="m-0">Admin - Manajemen Voucher</h5>
        </div>

        <!-- Main Content (diubah untuk admin) -->
        <div class="flex-grow-1 p-3" id="main-content">
            <!-- Admin Panel -->
            <div class="admin-panel">
                <div class="admin-actions">
                    <button class="btn btn-primary" id="add-voucher-btn">
                        <i class="bi bi-plus-circle me-2"></i>Tambah Voucher
                    </button>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="show-expired-toggle">
                        <label class="form-check-label" for="show-expired-toggle">Tampilkan Voucher Kadaluarsa</label>
                    </div>
                </div>
                
                <!-- Voucher List -->
                <div id="voucher-list">
                    <!-- Voucher items akan ditambahkan secara dinamis di sini -->
                </div>
            </div>
        </div>

        <!-- Overlay for dimming background -->
        <div class="overlay" id="overlay"></div>

        <!-- Add/Edit Voucher Modal -->
        <div class="modal-content" id="voucher-form-modal">
            <h5 id="form-title">Tambah Voucher Baru</h5>
            <form id="voucher-form">
                <input type="hidden" id="voucher-id">
                <div class="form-group">
                    <label for="voucher-title">Judul Voucher</label>
                    <input type="text" class="form-control" id="voucher-title" placeholder="Contoh: Gratis Ongkir" required>
                </div>
                <div class="form-group">
                    <label for="voucher-name">Nama Voucher</label>
                    <input type="text" class="form-control" id="voucher-name" placeholder="Contoh: Gratis Ongkir Semua Merchant" required>
                </div>
                <div class="form-group">
                    <label for="voucher-type">Jenis Voucher</label>
                    <select class="form-control" id="voucher-type" required>
                        <option value="">Pilih Jenis</option>
                        <option value="shipping">Gratis Ongkir</option>
                        <option value="discount">Diskon</option>
                        <option value="cashback">Cashback</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="voucher-description">Deskripsi</label>
                    <input type="text" class="form-control" id="voucher-description" placeholder="Contoh: Min. pembelian Rp 50.000" required>
                </div>
                <div class="form-group">
                    <label for="voucher-max-discount">Maks. Diskon/Cashback (jika ada)</label>
                    <input type="text" class="form-control" id="voucher-max-discount" placeholder="Contoh: Maks. diskon Rp 50.000">
                </div>
                <div class="form-group">
                    <label for="voucher-expiry">Tanggal Kadaluarsa</label>
                    <input type="date" class="form-control" id="voucher-expiry" required>
                </div>
                <div class="form-group">
                    <label for="voucher-terms">Syarat & Ketentuan</label>
                    <textarea class="form-control" id="voucher-terms" rows="2" placeholder="Syarat dan ketentuan berlaku">Syarat dan ketentuan berlaku</textarea>
                </div>
                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="voucher-active">
                    <label class="form-check-label" for="voucher-active">
                        Voucher Aktif
                    </label>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" id="cancel-form-btn">Batal</button>
                    <button type="submit" class="btn btn-primary" id="save-voucher-btn">Simpan</button>
                </div>
            </form>
        </div>

        <!-- Success Modal -->
        <div class="modal-content success-modal" id="success-modal">
            <h5>Berhasil!</h5>
            <p id="success-message">Voucher berhasil ditambahkan!</p>
            <div class="success-icon">
                <i class="bi bi-check-circle"></i>
            </div>
            <button class="btn btn-back" id="success-back-btn">Kembali</button>
        </div>

        <!-- Delete Confirmation Modal -->
        <div class="modal-content" id="delete-confirm-modal">
            <h5>Konfirmasi Hapus</h5>
            <p>Apakah Anda yakin ingin menghapus voucher ini?</p>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancel-delete-btn">Batal</button>
                <button type="button" class="btn btn-danger" id="confirm-delete-btn">Hapus</button>
            </div>
        </div>

    </div>

    <script>
        // Sample voucher data
        let vouchers = [
            {
                id: 1,
                title: "Gratis Ongkir",
                name: "Gratis Ongkir Semua Merchant",
                type: "shipping",
                description: "Min. pembelian Rp 50.000",
                maxDiscount: "",
                expiry: "2023-12-30",
                terms: "Syarat dan ketentuan berlaku",
                active: true
            },
            {
                id: 2,
                title: "Gratis Ongkir",
                name: "Gratis Ongkir Merchant Terpilih",
                type: "shipping",
                description: "Min. pembelian Rp 30.000",
                maxDiscount: "",
                expiry: "2024-01-15",
                terms: "Syarat dan ketentuan berlaku",
                active: true
            },
            {
                id: 3,
                title: "Diskon 20%",
                name: "Diskon 20% Semua Produk",
                type: "discount",
                description: "Min. pembelian Rp 100.000",
                maxDiscount: "Maks. diskon Rp 50.000",
                expiry: "2023-12-25",
                terms: "Syarat dan ketentuan berlaku",
                active: true
            },
            {
                id: 4,
                title: "Cashback 10%",
                name: "Cashback 10% Transaksi Pertama",
                type: "cashback",
                description: "Min. pembelian Rp 50.000",
                maxDiscount: "Maks. cashback Rp 25.000",
                expiry: "2024-01-10",
                terms: "Syarat dan ketentuan berlaku",
                active: true
            }
        ];

        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById('overlay');
            const voucherFormModal = document.getElementById('voucher-form-modal');
            const successModal = document.getElementById('success-modal');
            const deleteConfirmModal = document.getElementById('delete-confirm-modal');
            const addVoucherBtn = document.getElementById('add-voucher-btn');
            const cancelFormBtn = document.getElementById('cancel-form-btn');
            const cancelDeleteBtn = document.getElementById('cancel-delete-btn');
            const confirmDeleteBtn = document.getElementById('confirm-delete-btn');
            const successBackBtn = document.getElementById('success-back-btn');
            const voucherForm = document.getElementById('voucher-form');
            const voucherList = document.getElementById('voucher-list');
            const showExpiredToggle = document.getElementById('show-expired-toggle');
            
            let currentVoucherId = null;
            let isEditing = false;

            // Initialize the voucher list
            renderVoucherList();

            // Event Listeners
            addVoucherBtn.addEventListener('click', function() {
                isEditing = false;
                document.getElementById('form-title').textContent = 'Tambah Voucher Baru';
                document.getElementById('voucher-form').reset();
                document.getElementById('voucher-id').value = '';
                showModal(voucherFormModal);
            });

            cancelFormBtn.addEventListener('click', function() {
                hideModal(voucherFormModal);
            });

            cancelDeleteBtn.addEventListener('click', function() {
                hideModal(deleteConfirmModal);
            });

            successBackBtn.addEventListener('click', function() {
                hideModal(successModal);
            });

            overlay.addEventListener('click', function() {
                hideAllModals();
            });

            voucherForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveVoucher();
            });

            showExpiredToggle.addEventListener('change', function() {
                renderVoucherList();
            });

            // Functions
            function renderVoucherList() {
                voucherList.innerHTML = '';
                
                const showExpired = showExpiredToggle.checked;
                const now = new Date();
                
                vouchers.forEach(voucher => {
                    const expiryDate = new Date(voucher.expiry);
                    const isExpired = expiryDate < now;
                    
                    // Skip expired vouchers if toggle is off
                    if (!showExpired && isExpired) return;
                    
                    const voucherElement = document.createElement('div');
                    voucherElement.className = 'voucher-item';
                    
                    const iconClass = getIconClass(voucher.type);
                    const statusClass = isExpired ? 'status-expired' : 'status-active';
                    const statusText = isExpired ? 'Kadaluarsa' : 'Aktif';
                    
                    voucherElement.innerHTML = `
                        <div class="voucher-item-header">
                            <span class="voucher-item-title">${voucher.title}</span>
                            <span class="voucher-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="voucher-item-body">
                            <div class="voucher-item-icon">
                                <i class="bi ${iconClass}"></i>
                            </div>
                            <div class="voucher-item-details">
                                <div class="voucher-item-name">${voucher.name}</div>
                                <p class="voucher-item-desc">${voucher.description}</p>
                                ${voucher.maxDiscount ? `<p class="voucher-item-desc">${voucher.maxDiscount}</p>` : ''}
                                <div class="voucher-item-expiry">Berlaku hingga ${formatDate(voucher.expiry)}</div>
                            </div>
                        </div>
                        <div class="voucher-item-footer">
                            ${voucher.terms}
                        </div>
                        <div class="voucher-actions">
                            <button class="btn btn-sm btn-warning edit-voucher" data-id="${voucher.id}">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger delete-voucher" data-id="${voucher.id}">
                                <i class="bi bi-trash"></i> Hapus
                            </button>
                        </div>
                    `;
                    
                    voucherList.appendChild(voucherElement);
                });
                
                // Add event listeners to edit and delete buttons
                document.querySelectorAll('.edit-voucher').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        editVoucher(id);
                    });
                });
                
                document.querySelectorAll('.delete-voucher').forEach(button => {
                    button.addEventListener('click', function() {
                        const id = parseInt(this.getAttribute('data-id'));
                        confirmDelete(id);
                    });
                });
            }

            function getIconClass(type) {
                switch(type) {
                    case 'shipping': return 'bi-truck';
                    case 'discount': return 'bi-percent';
                    case 'cashback': return 'bi-currency-dollar';
                    default: return 'bi-tag';
                }
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                const options = { day: 'numeric', month: 'long', year: 'numeric' };
                return date.toLocaleDateString('id-ID', options);
            }

            function showModal(modal) {
                overlay.style.display = 'block';
                modal.style.display = 'block';
            }

            function hideModal(modal) {
                overlay.style.display = 'none';
                modal.style.display = 'none';
            }

            function hideAllModals() {
                overlay.style.display = 'none';
                voucherFormModal.style.display = 'none';
                successModal.style.display = 'none';
                deleteConfirmModal.style.display = 'none';
            }

            function editVoucher(id) {
                isEditing = true;
                const voucher = vouchers.find(v => v.id === id);
                
                if (voucher) {
                    document.getElementById('form-title').textContent = 'Edit Voucher';
                    document.getElementById('voucher-id').value = voucher.id;
                    document.getElementById('voucher-title').value = voucher.title;
                    document.getElementById('voucher-name').value = voucher.name;
                    document.getElementById('voucher-type').value = voucher.type;
                    document.getElementById('voucher-description').value = voucher.description;
                    document.getElementById('voucher-max-discount').value = voucher.maxDiscount || '';
                    document.getElementById('voucher-expiry').value = voucher.expiry;
                    document.getElementById('voucher-terms').value = voucher.terms;
                    document.getElementById('voucher-active').checked = voucher.active;
                    
                    showModal(voucherFormModal);
                }
            }

            function saveVoucher() {
                const id = document.getElementById('voucher-id').value;
                const title = document.getElementById('voucher-title').value;
                const name = document.getElementById('voucher-name').value;
                const type = document.getElementById('voucher-type').value;
                const description = document.getElementById('voucher-description').value;
                const maxDiscount = document.getElementById('voucher-max-discount').value;
                const expiry = document.getElementById('voucher-expiry').value;
                const terms = document.getElementById('voucher-terms').value;
                const active = document.getElementById('voucher-active').checked;
                
                if (isEditing) {
                    // Update existing voucher
                    const index = vouchers.findIndex(v => v.id === parseInt(id));
                    if (index !== -1) {
                        vouchers[index] = {
                            ...vouchers[index],
                            title,
                            name,
                            type,
                            description,
                            maxDiscount,
                            expiry,
                            terms,
                            active
                        };
                    }
                    document.getElementById('success-message').textContent = 'Voucher berhasil diperbarui!';
                } else {
                    // Add new voucher
                    const newId = vouchers.length > 0 ? Math.max(...vouchers.map(v => v.id)) + 1 : 1;
                    vouchers.push({
                        id: newId,
                        title,
                        name,
                        type,
                        description,
                        maxDiscount,
                        expiry,
                        terms,
                        active
                    });
                    document.getElementById('success-message').textContent = 'Voucher berhasil ditambahkan!';
                }
                
                hideModal(voucherFormModal);
                renderVoucherList();
                showModal(successModal);
            }

            function confirmDelete(id) {
                currentVoucherId = id;
                showModal(deleteConfirmModal);
            }

            confirmDeleteBtn.addEventListener('click', function() {
                if (currentVoucherId) {
                    vouchers = vouchers.filter(v => v.id !== currentVoucherId);
                    renderVoucherList();
                    hideModal(deleteConfirmModal);
                    document.getElementById('success-message').textContent = 'Voucher berhasil dihapus!';
                    showModal(successModal);
                }
            });
        });
    </script>

</body>

</html>